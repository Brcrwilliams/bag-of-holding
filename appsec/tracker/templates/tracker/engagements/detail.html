{% extends "base.html" %}

{% load widget_tweaks %}
{% load humanize %}

{% block title %}Engagement{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-12">
    <a href="{% url 'tracker:application.detail' engagement.application.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Return to Application</a>
    <a href="{% url 'tracker:engagement.edit' engagement.id %}" class="btn btn-default pull-right" role="button"><span class="fa fa-pencil-square-o" aria-hidden="true"></span> Edit Engagement</a>
  </div>
</div>

<hr>

<div class="row">
  <div class="col-md-8">
    <h2 class="no-margin-top"><span class="fa fa-calendar" aria-hidden="true"></span> Engagement <small>{{ engagement.start_date }} <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> {{ engagement.end_date }}</small></h2>
    <p>Opened: {{ engagement.open_date }}</p>
    <p>Closed: {{ engagement.close_date }}</p>

    <hr>

    <h3><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Activities</h3>
    <a href="{% url 'tracker:activity.add' engagement.id %}" class="btn btn-default pull-right" role="button"><span class="fa fa-plus" aria-hidden="true"></span> Add Activity</a>
    <p class="text-muted">Activities are units of work performed over the engagement duration.</p>
    <h4>Pending <small>Activities that have not yet started</small></h4>
    {% if pending_activities %}
    <div class="list-group">
      {% for activity in pending_activities %}
      <a href="{% url 'tracker:activity.detail' activity.id %}" class="list-group-item">{{ activity.get_activity_type_display }}</a>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-muted">No pending activities</p>
    {% endif %}
    <h4>Open <small>Activities that are in progress</small></h4>
    {% if open_activities %}
    <div class="list-group">
      {% for activity in open_activities %}
      <a href="{% url 'tracker:activity.detail' activity.id %}" class="list-group-item">{{ activity.get_activity_type_display }}</a>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-muted">No open activities</p>
    {% endif %}
    <h4>Closed <small>Activities that have finished</small></h4>
    {% if closed_activities %}
    <div class="list-group">
      {% for activity in closed_activities %}
      <a href="#" class="list-group-item">{{ activity.get_activity_type_display }}</a>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-muted">No closed activities</p>
    {% endif %}

    <hr>

    <h3><span class="fa fa-comments" aria-hidden="true"></span> Comments</h3>
    {% if comments %}
    {% for comment in comments %}
    <blockquote>
      <p>{{ comment.message }}</p>
      <footer>{{ comment.user.first_name }} {{ comment.user.last_name }}, {{ comment.modified_date|naturaltime }}</footer>
    </blockquote>
    {% endfor %}
    {% else %}
    <p class="text-muted">No comments</p>
    {% endif %}

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Add comment</h3>
      </div>
      <div class="panel-body">
        <form method="post" action="{% url 'tracker:engagement.comment.add' engagement.id %}">
          {% csrf_token %}
          {% include "forms/form_snippet.html" with control=form.message %}

          <button class="btn btn-default" type="submit">Post comment</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="btn-group btn-group-justified" role="group" aria-label="status">
      <a href="#" class="btn btn-default{% if engagement.is_pending %} active{% endif %}" role="button"><span class="glyphicon glyphicon-pause" aria-hidden="true"></span> Pending</a>
      <a href="#" class="btn btn-default{% if engagement.is_open %} active{% endif %}" role="button"><span class="glyphicon glyphicon-play" aria-hidden="true"></span> Open</a>
      <a href="#" class="btn btn-default{% if engagement.is_closed %} active{% endif %}" role="button"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span> Closed</a>
    </div>
  </div>
</div>
{% endblock %}
